<!DOCTYPE html>
<html lang="en">
<head>
	
	<!--
		Basic
	-->
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
	<title>Evaluating data with Python</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<meta name="description" content="A simple way to evaluate data with Python." />
	
	<!--
		Load Fonts
	-->
	<link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.0/css/all.css">

	<!--
		Load CSS
	-->
	<link rel="stylesheet" href="css/basic.css" />
	<link rel="stylesheet" href="css/layout.css" />
	<link rel="stylesheet" href="css/blogs.css" />
	<link rel="stylesheet" href="css/ionicons.css" />
	<link rel="stylesheet" href="css/magnific-popup.css" />
	<link rel="stylesheet" href="css/animate.css" />
	<link rel="stylesheet" href="css/owl.carousel.css" />

	<link rel="stylesheet" href="css/prism.css"/>
	<!--
		Template New-Skin
	-->
	<link rel="stylesheet" href="css/new-skin/new-skin.css" />

	<!--
		Template Colors
	-->
	<link rel="stylesheet" href="css/template-colors/orange.css" />
	<!--
		Template Dark
	-->
	<link rel="stylesheet" href="css/template-dark/dark.css" />
	
	
	<!--[if lt IE 9]>
	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	
	<!--
		Favicons
	-->
	<link rel="shortcut icon" href="images/favicons/favicon.ico">
	<link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">	
</head>

<body>	
	<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v6.0&appId=703097563841075&autoLogAppEvents=1"></script>
	<div class="page new-skin">
		<div id="fb-root"></div>
		<script async defer crossorigin="anonymous" src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v6.0&appId=703097563841075&autoLogAppEvents=1"></script>
		
		<!-- preloader -->
		<div class="preloader">
			<div class="centrize full-width">
				<div class="vertical-center">
					<div class="spinner">
						<div class="double-bounce1"></div>
						<div class="double-bounce2"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- background -->
		<div class="background"></div>

		<!--
			Container
		-->
		<div class="container opened" data-animation-in="fadeInLeft" data-animation-out="fadeOutLeft">

			<!--
				Header
			-->
			<header class="header">

				<!-- menu -->
				<div class="top-menu">
					<ul>
						<li>
							<a href="index.html">
								<span class="icon ion-home"></span>
								<span class="link">Home</span>
							</a>
						</li>
						<li class="active">
							<a href="graph-plotting-w-python-matplotlib.html">
								<span class="icon ion-chatbox-working"></span>
								<span class="link">Blog</span>
							</a>
						</li>
					</ul>
				</div>

			</header>

			<!--
				Card - Started
			-->
			<div class="card-started">

				<!--
					Profile
				-->
				<div class="profile">

					<!-- profile image -->
					<div class="slide" style="background-image: url(images/bg.jpg);"></div>

					<!-- profile photo -->
					<div class="image">
						<img src="images/profile.png" alt="" />
					</div>

					<!-- profile titles -->
					<div class="title">Ueslei Adriano Sutil</div>
					<div class="subtitle">Oceanographer</div>

					<!-- profile socials -->
					<div class="social">
						<a target="_blank" href="https://www.linkedin.com/in/usutil/" rel="noopener noreferrer"><span class="fab fa-linkedin"></span></a>
						<a target="_blank" href="https://github.com/uesleisutil" rel="noopener noreferrer"><span class="fab fa-github"></span></a>
						<a target="_blank" href="https://www.researchgate.net/profile/Ueslei_Sutil" rel="noopener noreferrer"><span class="ai ai-researchgate"></span></a>
						<a target="_blank" href="http://lattes.cnpq.br/7449952079999911" rel="noopener noreferrer"><span class="ai ai-lattes"></span></a>
						<a target="_blank" href="https://orcid.org/0000-0002-7150-536X" rel="noopener noreferrer"><span class="ai ai-orcid"></span></a>
					</div>
					
					<!-- profile buttons -->
					<div class="lnks">
						<a href="files/UesleiCV.pdf" class="lnk" download>
							<span class="text">Download CV</span>
							<span class="ion ion-archive"></span>
						</a>
						<a href="index.html" class="lnk discover active">
							<span class="text">Back to home</span>
							<span class="arrow"></span>
						</a>
					</div>

				</div>

			</div>

			<!--
				Card - Blog
			-->
			<div class="card-inner blog blog-post animated" id="blog-card">
				<div class="card-wrap">

					<!--
						Blog Single
					-->
					<div class="content blog-single">

						<!-- title -->
						<div class="title">Blog Post</div>

						<!-- content -->
						<div class="row border-line-v">
							<div class="col col-m-12 col-t-12 col-d-12">
								<div class="post-box">
									
									<!-- blog detail -->
									<h1>Evaluating data with Python</h1>						
									<div class="blog-detail">Posted 30 Jun 2020</div>
									
									<!-- blog image -->
									<div class="blog-image">
										<img src="images/blog/xy_plots.png" alt="" />
									</div>  
									
									<!-- blog content -->
									<div class="blog-content">
										<p>
											Without a doubt, Python is one of the most famous programming language for data science, 
											but creating a script from scratch for data visualization can be tricky.
											In this article I will guide you to create a simple line graph. 
										</p>
										<p>
											Although nowadays there is plenty of options for data visualization in Python, 
											such as <strong>Seaborn</strong>, <strong>Plotly</strong> and <strong>Bokeh</strong>, in this article I will 
											write about the oldest and most famous Python's data visualization library,
											<strong>Matplotlib</strong>. 
										</p>
										<p>
											<strong>Matplotlib</strong> is a library used for creating static, animated, and interactive 
											visualizations, but despite being widely used, getting a plot to look right can
											be pretty time consuming. 
										</p>
										<p>
											
											So, this article is a beginner-to-intermediate-level walkthrough on Matplotlib coding
											and requires a previous understanding in programming language.
										</p>
										<p>
											Using the database from the the brazilian <a href="http://www.inmet.gov.br">
											<strong>National Institute of Meteorology</strong></a>, I created a comma-separated CSV file
											from a weather station located in the city of Blumenau, where 
											an extreme precipitation event occured in november 2008.
											You can download the file <a href="https://gist.github.com/uesleisutil/2bd4dce332c7be378a374b0bc2d9fba4"><strong>here</strong></a>.
										</p>
										<p>
											The file consists of three collums: the first one is the year, the second is the total precipitation 
											for november and the last one is the daily maximum precipitation in november. 
										</p>
										<p>
											First, if you do not have Python installed in your computer, I suggest to download and 
											install Anaconda, a Python open-source distribution that you can use to perform Python 
											data science, install libraries and manage environments. Download Anaconda 
											<strong><a href="https://www.anaconda.com/products/individual">here</a></strong>.
										</p>
										<p>
											After Anaconda is installed, install those libraries:
										</p>
										<p>
											<ul class="list-style">
												<li>Pandas;</li>
												<li>Numpy;</li>
												<li>Matplotlib.</li>
											</ul>
										</p>
										<p>
											Simply write down, in the terminal, the following:
										</p>
										<p>
											<pre><code class="language-bash">$ conda install -c anaconda pandas</code></pre>
											<pre><code class="language-shell">$ conda install -c anaconda pandas </code></pre>
											<pre><code class="language-shell">$ conda install -c anaconda matplotlib </code></pre>
										</p>
										<p>
											Write the following to import the Python libraries:
										</p>
										<p>
											<pre class="language-python"><code>import pandas as pd 
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
import matplotlib
from matplotlib.ticker import AutoMinorLocator</code></pre>
										</p>
										<p>
											We imported Pandas to easily handle with the CSV file. The <strong>read_csv</strong> function is used
											to read the <strong>blumenau.csv</strong> file. Also, we use: <strong>keep_default_na</strong> 
											to not erase the NaNs (Not a Number data), comma as <strong>delimiter</strong>, <strong>header</strong> parameter
											as None and the <strong>names</strong> of each collumn as Year, Total and DayMax.
										</p>
										<p>
										<pre><code class="language-python">
											file_name = pd.read_csv('blumenau.csv', 
																	keep_default_na=True,
																	delimiter=',', 
																	header=None,
																	names=['Year','Total', 'DayMax'])</code></pre>
										</p>

										<p>
											Store the Year collumn from <strong>file_name</strong> inside the <strong> year</strong> variable.
										</p>
										<p>
											<pre><code class="language-python">year = file_name['Year']
year = time_blu.values
										</code></pre>
										</p>
										<p>
											Store the total precipitation collumn (Total) from <strong>file_name</strong> inside the <strong> total_rain</strong> variable.
										</p>
										<p>
										<pre><code class="language-python">total_rain = file_name['Total']
total_rain = total_rain_blu.values</code></pre>
										</p>
										<p>
											Store the november maximum daily precipitation (DayMax) collumn from <strong>file_name</strong> inside the <strong> max_rain</strong> variable.
										</p>										
										<p>
										<pre><code class="language-python">max_rain = file_name['DayMax']
max_rain = max_rain.values
										</code></pre>
										</p>
										<p>
											Create the figure plot to draw the graph.
										</p>
										<p>
											<pre><code class="language-python">fig, axs = plt.subplots(1, 1)</code></pre>
										</p>

										<p>Using <strong> numpy</strong>, set the X and Y axis ticks according to the CSV file.</p>
								
										<p>
											<pre><code class="language-python">x_major_ticks = np.arange(1945, 2011, 5)
y_major_ticks = np.arange(0, 1001, 200)

											</code></pre>
										</p>

										<p> For the first line, put the <strong>year</strong> variable as the first parameter and 
											the <strong>max_rain</strong> as second. Set the <strong>linestyle</strong> as solid, with a dot <strong>marker</strong>
											in each data. Also, set the <strong>linewidth</strong> as 2 and the color as
											<strong>C0</strong> (Blue).
										</p> 
										<p>
										<pre><code class="language-python">
										axs.plot(year, max_rain,label='Total precipitation', 
												 linestyle='-', marker='.', linewidth=2, 
												 color='C0')      
										</pre></code></p>

										<p> For the second line, put the <strong>year</strong> variable as the first parameter and 
											the <strong>total_rain</strong> as second. Again, set the <strong>linestyle</strong> as solid, with 
											a dot <strong>marker</strong> in each data. Also, set the <strong>linewidth</strong> as 2, and the
											 color as <strong>crimson</strong> (Red).
										</p> 
										<p>
										<pre><code class="language-python">
											axs.plot(year, total_rain, 
													 label='Daily maximum precipitation', 
													 linestyle='-', marker='.', 
													 linewidth=2, color='crimson')     
										</pre></code></p>

										<p> Set the legend size and location.
										</p> 
										<p>
										<pre><code class="language-python">axs.legend(loc='upper left',fontsize=8)     
										</pre></code></p>

										<p> Use the <strong>set_minor_locator</strong> and <strong>tick_params</strong> to create nice axis ticks.
										</p> 
										<p>
										<pre><code class="language-python">axs.yaxis.set_minor_locator(AutoMinorLocator())
axs.tick_params(which='both',  width=2)
axs.tick_params(which='major', length=7)
axs.tick_params(which='minor', length=4)
										</pre></code></p>										

										<p> Import the ticks created earlier with <strong>Numpy</strong>.
										</p> 
										<p>
										<pre><code class="language-python">axs.set_xticks(x_major_ticks)
axs.set_yticks(y_major_ticks)
										</pre></code></p>										

										<p> Set axis labels.
										</p> 
										<p>
										<pre><code class="language-python">axs.set_ylabel('Precipitation [mm]',fontsize=9)
axs.set_xlabel('Year',fontsize=9)
										</pre></code></p>										

										<p> Set graph title.
										</p> 
										<p>
										<pre><code class="language-python">axs.set_title('November precipitation history')
										</pre></code></p>										

										<p> You can also highlight a specific part of the graph. In our case, 2008 was an extreme rainy
											year, so we gonna add a reference line in this year and write the amount of precipitation 
											for both red and blue lines. 
										</p> 
										<p>
										<pre><code class="language-python">
											axs.axvline(2008, color='k', linestyle=':', 
													    linewidth=1)
											axs.text(2003.7,980,'1001.2',color='C0')
											axs.text(2003.7,250,'250.9',color='crimson')
										</pre></code></p>

										<p> Save the figure.
										</p> 
										<p>
										<pre><code class="language-python">fig.set_size_inches(11, 3)
fig.savefig('xy_graph_csv.png',transparent=False, 
			bbox_inches='tight', pad_inches=0, 
			dpi=250)
										</pre></code></p>											

										<p> Here is our figure. Note that there is gaps in both lines. 
											This is caused from the NaNs in our data.
										</p>
										
										<p><img src="images/blog/xy_graph_csv.png" alt="" width="100%" /></p>

										<p>The complete script is:</p>

										<p>
										<pre><code class="language-python">
											"""
											Author:         Ueslei Adriano Sutil
											Email:          uesleisutil1@gmail.com
											Created:        07 Apr 2020
											Last modified:  22 Apr 2020
											Version:        2.0
											
											Creates XY graph from CSV file.
											"""
											
											import pandas as pd
											import numpy as np
											from matplotlib.ticker   import AutoMinorLocator
											import matplotlib.pyplot as plt
											import matplotlib.dates  as mdates
											import matplotlib
											import netCDF4
											import scipy.stats
											matplotlib.use('Agg
											
											# Matplotlib resources.
											plt.rcParams.update({
												'font.family':'sans-serif',
												'font.sans-serif':['Liberation Sans'],
												'font.size':'12',
												})
											
											# Open CSV file and import variables.
											csv_import = pd.read_csv('arduino.csv',
																	  keep_default_na=True, delimiter=',', 
																	  header=None,names=['Temp_BME','Pressure_BME'])
											
											temp_bme   = csv_import['temp_bme']
											temp_bme   = temp_bme.values
											pres_bme   = csv_import['Pressure_BME']
											pres_bme   = pres_bme.values
											
											csv_import = pd.read_csv('inmet.csv',
																	  keep_default_na=True, delimiter=',', 
																	  header=None, names=['Temp','Pressure'])
											
											temp_inmet = csv_import['Temp']
											temp_inmet = temp_inmet.values
											pres_inmet = csv_import['Pressure']
											pres_inmet = pres_inmet.values-5
											
											# Calculate correlation, trend and RMSE.
											# Variable 1 (Temperature).
											stats = scipy.stats.spearmanr(temp_bme,temp_inmet, axis=0, 
											                              nan_policy='propagate')
											cor1  = str(stats[0])
											pval1 = stats[1]
											cor1  = cor1[0:5]
											z1    = np.polyfit(temp_bme,temp_inmet, 1)
											p1    = np.poly1d(z1)
											rmse1 = np.sqrt(np.mean((temp_bme-temp_inmet)**2))
											rmse1 = str(rmse1)
											rmse1 = rmse1[0:4]
											
											bias1 = temp_bme-temp_inmet
											
											# Variable 2 (Pressure).
											stats = scipy.stats.spearmanr(pres_bme,pres_inmet, axis=0, nan_policy='propagate')
											cor2  = str(stats[0])
											pval2 = stats[1]
											cor2  = cor2[0:5]
											z2    = np.polyfit(pres_bme,pres_inmet, 1)
											p2    = np.poly1d(z2)
											
											rmse2 = np.sqrt(np.mean((pres_bme-pres_inmet)**2))
											rmse2 = str(rmse2)
											rmse2 = rmse2[0:4]
											
											bias2 = pres_bme-pres_inmet
											
											# Arrange time variable.
											idx   = pd.date_range('2020-04-12 12:00', '2020-04-19 18:45', freq = '1H')
											hours = mdates.HourLocator(interval = 6)
											h_fmt = mdates.DateFormatter('%d/%M %Hh')
											
											# Create figures subplots.
											axs = plt.subplots(4, 1, constrained_layout=True)
											fig = plt.figure()
											
											# Y-axis range for both plots.
											y_major_ticks  = np.arange(15, 32, 3)
											y_major_ticks2 = np.arange(938, 953.1, 3)
											y_major_ticks3 = np.arange(0, 1, 2)
											y_major_ticks4 = np.arange(-4, 5, 0.5)
											
											# Plot the figures.
											# Plot 1.
											ax1 = plt.subplot2grid((3,3), (0,0),rowspan=1,colspan=2)
											ax1.plot(idx,temp_bme,linestyle='-',label='Arduino', marker='',linewidth=2,color='C0')  
											ax1.plot(idx,temp_inmet,linestyle='-',label='INMET',marker='',linewidth=2,color='crimson') 
											#fill_between(idx, temp_bme, temp_inmet,alpha=0.3,color='gray')
											ax1.legend(loc='upper left',fontsize=10)
											ax1.xaxis.set_minor_locator(AutoMinorLocator())
											ax1.yaxis.set_minor_locator(AutoMinorLocator())
											ax1.tick_params(which='both',  width=2)
											ax1.tick_params(which='major', length=7)
											ax1.tick_params(which='minor', length=4)
											ax1.set_yticks(y_major_ticks)
											ax1.set_ylabel('Air Temperature \n [°C]',fontsize=12, labelpad=10)
											for label in ax1.get_xmajorticklabels():
												label.set_rotation(30)
												label.set_horizontalalignment("right")
											
											# Plot 2.
											ax2 = plt.subplot2grid((3,3), (1,0), rowspan=1,colspan=2) 
											ax2.plot(idx,pres_bme,label='Arduino',linestyle='-',marker='',linewidth=2,color='C0',alpha=1)    
											ax2.plot(idx,pres_inmet,label='INMET',linestyle='-',marker='',linewidth=2,color='crimson')
											ax2.legend(loc='upper left',fontsize=10)
											ax2.xaxis.set_minor_locator(AutoMinorLocator())
											ax2.yaxis.set_minor_locator(AutoMinorLocator())
											ax2.tick_params(which='both',  width=2)
											ax2.tick_params(which='major', length=7)
											ax2.tick_params(which='minor', length=4)
											ax2.set_yticks(y_major_ticks2)
											ax2.set_ylabel('Atmospheric Pressure \n [hPa]',fontsize=12, labelpad=10)
											for label in ax2.get_xmajorticklabels():
												label.set_rotation(30)
												label.set_horizontalalignment("right")
											
											# Plot 3.
											ax3 = plt.subplot2grid((3,3), (2,0)) 
											ax3.scatter(temp_bme,temp_inmet,color='C0')   
											ax3.plot(temp_bme,p1(temp_bme),linestyle='-',color='crimson',linewidth=2)
											ax3.xaxis.set_minor_locator(AutoMinorLocator())
											ax3.yaxis.set_minor_locator(AutoMinorLocator())
											ax3.tick_params(which='both',  width=2)
											ax3.tick_params(which='major', length=7)
											ax3.tick_params(which='minor', length=4)
											ax3.set_yticks(y_major_ticks)
											ax3.set_xticks(y_major_ticks)
											ax3.set_ylabel('Air Temperature \n INMET [°C]',fontsize=12, labelpad=10)
											ax3.set_xlabel('Air Temperature \n Arduino [°C]',fontsize=12, labelpad=10)
											ax3.text(26.4,14.2,'r² = '+cor1,color='k',fontsize=12)
											if pval1 < 0.001:
												ax3.text(26.5,15.2,'p < 0.001',color='k',fontsize=12)
											else:
												ax3.text(26.6,15.2,'p > 0.001',color='k',fontsize=12)  
											ax3.text(25.9,16.2,'RMSE: '+rmse1,color='k',fontsize=12)
											
											# plot 4.
											ax4 = plt.subplot2grid((3,3), (2,1),)     
											ax4.scatter(pres_bme,pres_inmet,color='C0')  
											ax4.plot(pres_bme,p2(pres_bme),linestyle='-',color='crimson',linewidth=2)
											ax4.xaxis.set_minor_locator(AutoMinorLocator())
											ax4.yaxis.set_minor_locator(AutoMinorLocator())
											ax4.tick_params(which='both',  width=2)
											ax4.tick_params(which='major', length=7)
											ax4.tick_params(which='minor', length=4)
											ax4.set_yticks(y_major_ticks2)
											ax4.set_xticks(y_major_ticks2)
											ax4.set_ylabel('Atmospheric Pressure \n INMET [hPa]',fontsize=12, labelpad=10)
											ax4.set_xlabel('Atmospheric Pressure \n Arduino [hPa]',fontsize=12, labelpad=10)
											ax4.text(948.8,936.9,'r² = '+cor2,color='k',fontsize=12)
											if pval2 < 0.001:
												ax4.text(948.9,937.9,'p < 0.001',color='k',fontsize=12)
											else:
												ax4.text(948.9,937.9,'p > 0.001',color='k',fontsize=12)
											ax4.text(948.3,938.9,'RMSE: '+rmse2,color='k',fontsize=12)
											
											# Set final fig resources and then save figure.
											fig.set_size_inches(13, 13)
											fig.tight_layout()
											fig.subplots_adjust(hspace = 0.3)
												  </code></pre>
											  </p>

											  <div class="fb-like" data-href="https://uesleisutil.com.br/comparing-and-evaluating-data-w-python.html" data-width="350" data-layout="button_count" data-action="like" data-size="large" data-share="true"></div>
									</div>

								</div>
							</div>
						</div>
						<!-- title -->
						<div class="title">Comments</div>
						<div class="fb-comments" data-href="https://uesleisutil.com.br/comparing-and-evaluating-data-w-python.html" data-mobile="Auto-detected" colorscheme="Dark" data-numposts="5" data-width="450"></div>
						

					</div>

				</div>
			</div>

		</div>
	</div>
	
	<!--
		jQuery Scripts
	-->
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.validate.js"></script>
	<script src="js/jquery.magnific-popup.js"></script>
	<script src="js/imagesloaded.pkgd.js"></script>
	<script src="js/isotope.pkgd.js"></script>
	<script src="js/jquery.slimscroll.js"></script>
	<script src="js/owl.carousel.js"></script>
	<script src="js/prism.js"></script>
	<script src="js/prism-normalize-whitespace.js"></script>
	<script type="text/javascript">
		// Optional
		Prism.plugins.NormalizeWhitespace.setDefaults({
			'remove-trailing': true,
			'remove-indent': true,
			'left-trim': true,
			'right-trim': true,
		});
		</script>
	<!--
		Google map api
	-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDz2w7HUaWudHwd7AWQpCL48Qs050WOn9s"></script>
	
	<!--
		Main Scripts
	-->
	<script src="js/scripts.js"></script>
	
</body>
</html>